# Superscalar_flower.OoO-execution

这是一个使用Verilog实现的RISC-V RV32I指令集超标量乱序执行处理器，
这个版本是我在
- [**StampFlow-11E_cpu**]([https://github.com/你的用户名/另一个项目](https://github.com/wangjiale114514/StampFlow-11E_cpu))：这个项目就是他的1.0形态感兴趣的可以看一下
在这个项目中的2.0那个文件夹中有部分过程代码也可以看一下
目前这个项目暂未完全完工进行测试，不过已经比较完善了，id阶段还没有进行操作数分发和RAT快照,LSU等等还未实现
目前只支持机器态

## 项目概述
这是一个高性能的处理器设计，采用乱序执行和超标量技术，
他包含保留站、重排序缓冲器(ROB)、分支预测器、物理寄存器重命名技术等内容，

### 核心特性
- **指令集架构**: RISC-V RV32I（32位整数指令集）
- **执行方式**: 超标量乱序执行
- **发射宽度**: 每周期最多取指8条、译码4条、发射2条、提交4条
- **执行单元**: 2个ALU + 1个LSU + 2个分支单元
- **分支预测**: 2位饱和计数器的BHT分支预测器（4096表项）
- **寄存器重命名**: 物理寄存器堆 + 寄存器别名表(RAT)
- **缓存层级**: L1指令缓存 + L1数据缓存 + L2缓存 + L3缓存
- **结果广播**: 4通道公共数据总线(CDB)

## 架构设计

![hello](https://github.com/wangjiale114514/Superscalar_flower.OoO-execution/blob/main/cpu.png)

### 流水线阶段

```
IF => ID => ROB => RS => EX => CDB => COMMIT
```
### 关键模块

#### 1. IF阶段
- 从if阶段取8条指令并根据BP给出的地址进行跳转，连接I_cache缓存和L2

#### 2. ID阶段 (id.v)
指令译码、寄存器重命名、微操作分解，他有32项指令缓冲器，因为if阶段和译码窗口不匹配所以当缓冲接近满时反压IF阶段

#### 3. ROB (rob.v)
维护指令执行顺序，等待顺序提交

#### 4. 保留站 (rs.v)
存储等待发射的指令，监控操作数就绪状态，通过CDB广播更新操作数，16个条目

#### 5. ALU (alu.v)
执行整数算术和逻辑运算，允许并行执行
- 算术运算: ADD, SUB, SLL, SRL, SRA, SLT, SLTU
- 逻辑运算: AND, OR, XOR
- 分支指令: BEQ, BNE, BLT, BGE, BLTU, BGEU


#### 6. CDB (cdb.v)
公共数据总线，广播执行结果，总共四个宽度

#### 7. 分支预测器 (bp.v)
预测分支指令的跳转方向，使用2位饱和计数器BHT条目4096个

#### 8. 物理寄存器堆 (prf.v)
存储执行结果的物理寄存器共256个物理寄存器，支持多端口读写

#### 9. 缓存系统 (cache/)
- **I_cache.v**: L1指令缓存
- **D_cache.v**: L1数据缓存
- **L2_cache.v**: L2统一缓存
- **L3_cache.v**: L3缓存（扩展接口）

### 10.具体性能
- 指令集 : RV32I
- 流水线深度 : 约等于8级
- 发射宽度 : 2路超标量
- 取指宽度 : 每周期8条
- 译码宽度 : 每周期4条
- ROB大小 : 128项
- 保留站大小 : 16项
- 物理寄存器数 : 256个
- BHT表项 : 4096个
- CDB通道数 : 4

## 文件结构

```
luan/
├── cpu_top.v          # CPU顶层模块
├── alu.v              # 算术逻辑单元
├── bp.v               # 分支预测器
├── cdb.v              # 公共数据总线
├── id.v               # 指令译码器
├── if.v               # 取指单元
├── prf.v              # 物理寄存器堆
├── rat_shot.v         # 寄存器别名表快照
├── regfile.v          # 寄存器堆
├── rob.v              # 重排序缓冲器
├── rs.v               # 保留站
├── inst_mem.v         # 指令存储器接口
├── cpu_tb.v           # CPU测试平台
├── cache/
│   ├── I_cache.v      # L1指令缓存
│   ├── D_cache.v      # L1数据缓存
│   ├── L2_cache.v     # L2缓存
│   └── L3_cache.v     # L3缓存
└── cpu.png            # CPU架构图
```


